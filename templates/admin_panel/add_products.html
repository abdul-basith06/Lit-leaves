{% extends 'partials/admin_base.html' %}
{%load static %}
{% block content %}



<div class="main-panel">
  <div class="content-wrapper">
      <div class="col-md-8">
        <div class="product-form">
          <form method="post" action="{% url 'admin_panel:addd_products' %}" enctype="multipart/form-data" id="productForm">
            {% csrf_token %}
            {% if messages %}
            <div class="alert alert-danger">
                {% for message in messages %}
                    {{ message }}
                {% endfor %}
            </div>
            {% endif %}
      
            <!-- Product Name -->
            <div class="form-group">
                <label for="name">Name</label>
                <input type="text" name="name" class="form-control" required>
            </div>
      
            <!-- Product Description -->
            <div class="form-group">
                <label for="description">Description</label>
                <textarea name="description" class="form-control" required></textarea>
            </div>
      
            <!-- Product Author -->
            <div class="form-group">
                <label for="author">Author</label>
                <input type="text" name="author" class="form-control" required>
            </div>
      
            <!-- Product Price -->
            <div class="form-group">
                <label for="price">Price</label>
                <input type="number" name="price" class="form-control" required>
            </div>
      
            <!-- Product Category -->
            <div class="form-group">
                <label for="category">Category</label>
                <select name="category" class="form-control" required>
                    <option value="" disabled selected>Select a category</option>
                    {% for category in all_cat %}
                    <option value="{{ category.id }}">{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>
      
            <!-- Product Image Upload -->
            <div class="form-group">
                <label for="image">Product Images</label>
                <input type="file" name="image" class="form-control" accept="image/*" multiple required id="imageInput">
            </div>
      
            <div class="form-group" id="imagePreviewGroup">
                <img id="imagePreview" src="" alt="Image Preview">
            </div>
      
            <button id="cropButton" class="btn btn-primary" disabled>Crop Images</button>
      
            <input type="hidden" name="cropped_images" id="croppedImages" value="">
      
            <button type="submit" class="btn btn-success" id="addProductButton">Add Product</button>
          </form>
        </div>
      </div>
          {% endblock content %}
          {% block scripts %}

          <!-- JavaScript code for image cropping -->
          <script>
            document.addEventListener("DOMContentLoaded", function () {
              const imageInput = document.getElementById('imageInput');
              const imagePreview = document.getElementById('imagePreview');
              const cropButton = document.getElementById('cropButton');
              const addProductButton = document.getElementById('addProductButton');
              const productForm = document.getElementById('productForm');
              let cropper;
      
              imageInput.addEventListener('change', (e) => {
                  if (e.target.files.length > 0) {
                      // Check if a file was selected
                      const selectedImage = e.target.files[0];
      
                      // Create a URL for the selected image and set it as the source of the image preview
                      imagePreview.src = URL.createObjectURL(selectedImage);
      
                      // Enable the "Crop Image" button
                      cropButton.removeAttribute('disabled');
      
                      // Initialize Cropper.js with the image element
                      cropper = new Cropper(imagePreview, {
                          aspectRatio: 1, // You can adjust this as needed
                          viewMode: 1,
                          autoCropArea: 1,
                          checkCrossOrigin: false,
                          ready: function () {
                              // This function is called when the cropper is ready
                          },
                      });
                  }
              });
      
              cropButton.addEventListener('click', (e) => {
                  e.preventDefault(); // Prevent form submission
      
                  // Check if the cropper has been initialized
                  if (cropper) {
                      // Crop the image and send data to the server
                      const croppedImageData = cropper.getCroppedCanvas().toDataURL('image/jpeg');
      
                      // Set the cropped image data in the hidden input
                      document.getElementById('croppedImages').value = croppedImageData;
      
                      // Enable the "Add Product" button if needed
                      // addProductButton.removeAttribute('disabled');
                  }
              });
      
              // Prevent the default form submission when the "Crop Image" button is clicked
              productForm.addEventListener('submit', (e) => {
                  if (e.target === cropButton) {
                      e.preventDefault();
                  }
              });
            });
          </script>
          {% endblock scripts %}
